---
# Play to install, start and verify MySQL service
- name: Install, start and check MySQL service
  hosts: all
  become: yes

  tasks:

    # Install MySQL server package
    - name: Install MySQL
      package:
        name: mysql-server
        state: present
      register: mysql_install_result
      tags: install

    # Print installation status
    - name: Print MySQL installation status
      debug:
        msg: >-
          MySQL was {{
            'installed now' if mysql_install_result.changed
            else 'already installed'
          }}
      tags: install

    # Start and enable MySQL service
    - name: Ensure MySQL service is started and enabled
      service:
        name: mysql
        state: started
        enabled: yes
      tags: service

    # Gather service facts
    - name: Gather service facts
      service_facts:
      tags: check

    # Assert MySQL service is running
    - name: Assert MySQL service is running
      assert:
        that:
          - "'mysql.service' in ansible_facts.services"
          - ansible_facts.services['mysql.service'].state == 'running'
        fail_msg: "❌ MySQL service is NOT running."
        success_msg: "✅ MySQL service is running."
      tags: check
